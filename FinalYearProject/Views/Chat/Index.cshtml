@{
    ViewData["Title"] = "Chat with Bakery Assistant";
}

<div class="chat-container">
    <div class="chat-messages" id="chatMessages">
        <!-- Chat messages will be dynamically inserted here -->
    </div>
    <div class="chat-input-container">
        <input type="text" id="messageInput" class="chat-input" placeholder="Type your message here..." />
        <button id="sendButton" class="chat-send-button">Send</button>
    </div>
</div>

@section Styles {
    <style>
        .chat-container {
            max-width: 800px;
            margin: 20px auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            background-color: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            max-width: 80%;
        }

        .message.user {
            margin-left: auto;
        }

        .message-content {
            padding: 10px 15px;
            border-radius: 15px;
            display: inline-block;
        }

        .user .message-content {
            background-color: #007bff;
            color: white;
        }

        .assistant .message-content {
            background-color: #e9ecef;
            color: #212529;
        }

        .chat-input-container {
            display: flex;
            padding: 20px;
            background-color: white;
            border-top: 1px solid #ddd;
        }

        .chat-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            margin-right: 10px;
        }

        .chat-send-button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }

        .chat-send-button:hover {
            background-color: #0056b3;
        }
    </style>
}

@section Scripts {
    <script>
        $(document).ready(function () {
            loadChatHistory();

            $('#messageInput').keypress(function (e) {
                if (e.which == 13) {
                    sendMessage();
                }
            });

            $('#sendButton').click(function () {
                sendMessage();
            });

            function loadChatHistory() {
                $.get('/Chat/GetChatHistory', function (messages) {
                    messages.forEach(function (message) {
                        appendMessage(message);
                    });
                    scrollToBottom();
                });
            }

            function sendMessage() {
                var messageInput = $('#messageInput');
                var message = messageInput.val().trim();

                if (message) {
                    appendMessage({
                        role: 'user',
                        content: message
                    });

                    $.ajax({
                        url: '/Chat/SendMessage',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(message),
                        success: function (response) {
                            appendMessage(response);
                            scrollToBottom();
                        },
                        error: function () {
                            alert('Error sending message');
                        }
                    });

                    messageInput.val('');
                }
            }

            function appendMessage(message) {
                var messageHtml = `
                    <div class="message ${message.role}">
                        <div class="message-content">${message.content}</div>
                    </div>
                `;
                $('#chatMessages').append(messageHtml);
                scrollToBottom();
            }

            function scrollToBottom() {
                var chatMessages = $('#chatMessages');
                chatMessages.scrollTop(chatMessages[0].scrollHeight);
            }
        });
    </script>
}